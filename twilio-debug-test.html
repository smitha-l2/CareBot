<!DOCTYPE html>
<html>
<head>
    <title>Twilio WhatsApp Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .info { background: #e3f2fd; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .success { background: #e8f5e8; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .error { background: #ffebee; padding: 15px; border-radius: 5px; margin: 10px 0; }
        input, button { padding: 10px; margin: 5px; font-size: 16px; }
        button { background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üîç Twilio WhatsApp Debug Test</h1>
    
    <div class="info">
        <h3>üì± Critical Steps to Check:</h3>
        <ol>
            <li><strong>Did you join the sandbox?</strong> Send WhatsApp message to <strong>+1 415 523 8886</strong></li>
            <li><strong>Message content:</strong> Check your Twilio Console for exact code (like "join clever-monkey")</li>
            <li><strong>Phone number format:</strong> Must match exactly how you joined the sandbox</li>
            <li><strong>Confirmation received?</strong> You should get a reply confirming you joined</li>
        </ol>
    </div>

    <h3>üß™ Test Different Phone Number Formats:</h3>
    
    <div>
        <label>Phone Number:</label>
        <input type="text" id="phoneNumber" value="8096168424" placeholder="Enter your phone number">
        <br>
        <button onclick="testFormat('+91')">Test with +91</button>
        <button onclick="testFormat('')">Test without country code</button>
        <button onclick="testFormat('+1')">Test with +1 (US format)</button>
    </div>

    <div id="results"></div>

    <div class="info">
        <h3>üîç How to Check Twilio Console:</h3>
        <ol>
            <li>Go to: <strong>https://console.twilio.com/</strong></li>
            <li>Navigate to: <strong>Messaging ‚Üí Try it out ‚Üí Send a WhatsApp message</strong></li>
            <li>Look for the <strong>sandbox participants</strong> section</li>
            <li>Check if your number appears there</li>
            <li>Look at <strong>Messaging ‚Üí Logs</strong> for delivery status</li>
        </ol>
    </div>

    <script>
        async function testFormat(countryCode) {
            const phoneNumber = document.getElementById('phoneNumber').value;
            const fullNumber = countryCode + phoneNumber;
            
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML += `<div class="info">Testing: ${fullNumber}...</div>`;
            
            try {
                const response = await fetch('http://localhost:8080/api/upload', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        'patientName': 'Format Test',
                        'contactNumber': fullNumber,
                        'dateOfBirth': '1990-01-01',
                        'uploadedBy': 'debug-test'
                    })
                });
                
                const result = await response.json();
                
                if (result.whatsappMethod === 'Twilio Automatic Send') {
                    resultsDiv.innerHTML += `<div class="success">‚úÖ ${fullNumber}: Twilio accepted - check your phone!</div>`;
                } else {
                    resultsDiv.innerHTML += `<div class="error">‚ùå ${fullNumber}: Fell back to URL generation</div>`;
                }
                
                console.log('Result:', result);
                
            } catch (error) {
                resultsDiv.innerHTML += `<div class="error">‚ùå ${fullNumber}: Error - ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
